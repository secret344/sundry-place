# 滑动窗口

TCP 是一个可靠的协议，每发送一个数据，都要进行一次确认应答。上一个包数据收到了，在发送下一个数据。但是这种方式是非常低效的，当往返时间越长就会导致效率越低，为了解决这个问题引入了窗口概念。

有窗口就可以指定窗口大小，TCP 的 Window 是一个 16bit 位字段，它代表的是窗口的字节容量，也就是 TCP 的标准窗口最大为 2^16-1=65535 个字节。

## 基本原理

1. 对于 TCP 的发送方的窗口，任何时候缓存在内的数据都可以分为 4 类：

    - 已发送并受到 ACK 确认
    - 已发送未收到 ACK 确认
    - 未发送但是允许发送的
    - 未发送但超过接收方处理大小的

假设，当发送方发送完“全部”数据，可用窗口大小为 0，表明可用窗口耗尽，没收到 ACK 之前是无法继续发送数据了。

> 发送窗口计算：

-   SND.WND

表示发送窗口大小。（接收方定义）

-   SND.UNA

一个绝对指针，指向已发送未收到 ACK 确认范围的第一个序号。

-   SND.NXT

一个绝对指针，指向未发送可发送范围的第一个序号。

> 由此： 发送方窗口大小 = SND.WND ； 可用窗口大小 = SND.WND - (SND.NXT - SND.UNA)； 未发送超过范围第一个序号 = SND.UNX + SND.WND

1. 对于 TCP 的接收方的窗口,分为 3 类：
    - 已接受并确认
    - 未收到但可以接收的（ACK 由 TCP 协议回复 默认 0 延迟）
    - 未收到不能接收的

> 接收方窗口计算相对简单:

-   RCV.WND

接收窗口大小，通过 ACK 通知发送方

-   RCV.NXT

指针指向期望从发送放接收的下一个数据字节的序列号

-   未收到不可接收的第一个序号：RCV.WND + RCV.NXT

> 注意，接收方与发送方窗口不一定相等，约等于发送方窗口。

## 流量控制
